---
title: "Analysing the Annual Statistical Report on Homicides in Toronto between 2004 to 2020"
subtitle: "My subtitle if needed"
author: 
  - Sarah Lee
thanks: "Code and data are available at: https://github.com/sarahhhh02/murrumbidgee_paper.git."
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(opendatatoronto)
library(ggplot2)
library(tidyverse)
library(dplyr)
library(knitr)

```

```{r}
#### Retrieve Data ####
homicides_clean1 <- read.csv(here::here("data/analysis_data/homicides_clean1.csv"))
homicides_clean2 <- read.csv(here::here("data/analysis_data/homicides_clean2.csv"))


### Retrieve Model ###
first_model <- readRDS(here::here("models/first_model.rds"))

```

# Introduction

You can and should cross-reference sections and sub-sections. We use @citeR and @rohan.

The remainder of this paper is structured as follows. @sec-data....

```{r}
#| message: false
#| echo: false
#| tbl-cap: Total Homicide Cases per Year
#| label: tbl-homicidetypecounts

# Assuming 'occurrence_year' is the column containing the year information
homicides_by_year <- homicides_clean1 |>
  group_by(year) |>
  summarise(total = n())

knitr::kable(homicides_by_year,'markdown',col.names = c("Year", "Total Homicides"), align = 'c')
```

```{r}
#| message: false
#| echo: false
#| tbl-cap: Total Homicide Cases per Year by Homicide Types
#| label: tbl-homicidetypecountsperyear

homicides_clean2 |>
  kable(
    col.names = c("Year", "Homicide Type", "Count"),
    align = c("l", "r", "r"),
    digits = 0, booktabs = TRUE, linesep = ""
  )

```

# Data {#sec-data}

Some of our data is of penguins (@fig-bills), from @palmerpenguins.

```{r}
#| label: fig-1
#| fig-cap: Bills of penguins
#| echo: false


homicides_clean2 |>
  ggplot(aes(x = year, y = count, color = homicide_type)) +
  geom_line() +
  theme_minimal() +
  scale_color_brewer(palette = "Set1") +
  labs(x = "Year", y = "Annual number of Homicides in Toronto") +
  facet_wrap(vars(homicide_type), dir = "v", ncol = 1) +
  theme(legend.position = "none")



```

Talk more about it.

And also planes (@fig-planes). (You can change the height and width, but don't worry about doing that until you have finished every other aspect of the paper - Quarto will try to make it look nice and the defaults usually work well once you have enough text.)

```{r}
#| label: fig-1
#| fig-cap: Bills of penguins
#| echo: false

base_plot <- 
  homicides_clean1|>
  ggplot(aes(x = year, y = homicides_by_year)) +
  geom_point(alpha = 1396) +
  labs(
    x = "Five-kilometer time (minutes)",
    y = "Marathon time (minutes)"
  ) +
  theme_classic()

base_plot
```

Talk way more about it.

# Model

The goal of our modelling strategy is twofold. Firstly,...

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details].

## Model set-up

Define $y_i$ as the number of seconds that the plane remained aloft. Then $\beta_i$ is the wing width and $\gamma_i$ is the wing length, both measured in millimeters.

```{=tex}
\begin{align} 
y_i|\mu_i, \sigma &\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_i + \gamma_i\\
\alpha &\sim \mbox{Normal}(0, 2.5) \\
\beta &\sim \mbox{Normal}(0, 2.5) \\
\gamma &\sim \mbox{Normal}(0, 2.5) \\
\sigma &\sim \mbox{Exponential}(1)
\end{align}
```
We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.

### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.

# Results

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(rstanarm)

first_model <-
  readRDS(file = here::here("models/first_model.rds"))
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false

modelsummary::modelsummary(
  list(
    "First model" = first_model
  ),
  statistic = "mad",
  fmt = 2
)
```

# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this.

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {.unnumbered}

# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows...

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

pp_check(first_model) +
  theme_classic() +
  theme(legend.position = "bottom")

posterior_vs_prior(first_model) +
  theme_minimal() +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom") +
  coord_flip()
```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

plot(first_model, "trace")

plot(first_model, "rhat")
```

\newpage

# References
